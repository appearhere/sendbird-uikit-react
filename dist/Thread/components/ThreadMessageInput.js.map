{"version":3,"file":"ThreadMessageInput.js","sources":["../../../src/smart-components/Thread/components/ThreadMessageInput/index.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { Role } from '@sendbird/chat';\nimport { MutedState } from '@sendbird/chat/groupChannel';\n\nimport './index.scss';\n\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport MessageInput from '../../../../ui/MessageInput';\nimport { MessageInputKeys } from '../../../../ui/MessageInput/const';\nimport SuggestedMentionList from '../../../Channel/components/SuggestedMentionList';\nimport { useThreadContext } from '../../context/ThreadProvider';\nimport { useLocalization } from '../../../../lib/LocalizationContext';\n\nexport interface ThreadMessageInputProps {\n  className?: string;\n}\n\nconst ThreadMessageInput = (\n  props: ThreadMessageInputProps,\n  ref: React.MutableRefObject<any>,\n): React.ReactElement => {\n  const { className } = props;\n  const { config } = useSendbirdStateContext();\n  const { stringSet } = useLocalization();\n  const {\n    isMentionEnabled,\n    isOnline,\n    userMention,\n  } = config;\n  const {\n    currentChannel,\n    parentMessage,\n    sendMessage,\n    sendFileMessage,\n    isMuted,\n    isChannelFrozen,\n    allThreadMessages,\n  } = useThreadContext();\n  const messageInputRef = useRef();\n\n  const disabled = isMuted || (!(currentChannel?.myRole === Role.OPERATOR) && isChannelFrozen) || parentMessage === null;\n\n  // mention\n  const [mentionNickname, setMentionNickname] = useState('');\n  const [mentionedUsers, setMentionedUsers] = useState([]);\n  const [mentionedUserIds, setMentionedUserIds] = useState([]);\n  const [selectedUser, setSelectedUser] = useState(null);\n  const [mentionSuggestedUsers, setMentionSuggestedUsers] = useState([]);\n  const [ableMention, setAbleMention] = useState(true);\n  const [messageInputEvent, setMessageInputEvent] = useState(null);\n  const displaySuggestedMentionList = isOnline\n    && isMentionEnabled\n    && mentionNickname.length > 0\n  // && !utils.isDisabledBecauseFrozen(channel)\n  // && !utils.isDisabledBecauseMuted(channel);\n  useEffect(() => {\n    if (mentionedUsers?.length >= userMention?.maxMentionCount) {\n      setAbleMention(false);\n    } else {\n      setAbleMention(true);\n    }\n  }, [mentionedUsers]);\n  useEffect(() => {\n    setMentionedUsers(mentionedUsers.filter(({ userId }) => {\n      const i = mentionedUserIds.indexOf(userId);\n      if (i < 0) {\n        return false;\n      } else {\n        mentionedUserIds.splice(i, 1);\n        return true;\n      }\n    }));\n  }, [mentionedUserIds]);\n\n  return (\n    <div className={`sendbird-thread-message-input ${className}`}>\n      {\n        displaySuggestedMentionList && (\n          <SuggestedMentionList\n            targetNickname={mentionNickname}\n            inputEvent={messageInputEvent}\n            // renderUserMentionItem={renderUserMentionItem}\n            onUserItemClick={(user) => {\n              if (user) {\n                setMentionedUsers([...mentionedUsers, user]);\n              }\n              setMentionNickname('');\n              setSelectedUser(user);\n              setMessageInputEvent(null);\n            }}\n            onFocusItemChange={() => {\n              setMessageInputEvent(null);\n            }}\n            onFetchUsers={(users) => {\n              setMentionSuggestedUsers(users);\n            }}\n            ableAddMention={ableMention}\n            maxMentionCount={userMention?.maxMentionCount}\n            maxSuggestionCount={userMention?.maxSuggestionCount}\n          />\n        )\n      }\n      <MessageInput\n        className=\"sendbird-thread-message-input__message-input\"\n        messageFieldId=\"sendbird-message-input-text-field--thread\"\n        disabled={disabled}\n        channelUrl={currentChannel?.url}\n        mentionSelectedUser={selectedUser}\n        isMentionEnabled={isMentionEnabled}\n        ref={ref || messageInputRef}\n        placeholder={\n          (currentChannel?.isFrozen && !(currentChannel?.myRole === Role.OPERATOR) && stringSet.MESSAGE_INPUT__PLACE_HOLDER__DISABLED)\n          || (currentChannel?.myMutedState === MutedState.MUTED && stringSet.MESSAGE_INPUT__PLACE_HOLDER__MUTED_SHORT)\n          || (allThreadMessages.length > 0\n            ? stringSet.THREAD__INPUT__REPLY_TO_THREAD\n            : stringSet.THREAD__INPUT__REPLY_IN_THREAD\n          )\n        }\n        onStartTyping={() => {\n          currentChannel?.startTyping?.();\n        }}\n        onSendMessage={({ message, mentionTemplate }) => {\n          sendMessage({\n            message: message,\n            mentionedUsers,\n            mentionTemplate: mentionTemplate,\n            quoteMessage: parentMessage,\n          });\n          setMentionNickname('');\n          setMentionedUsers([]);\n          currentChannel?.endTyping?.();\n        }}\n        onFileUpload={(file) => {\n          sendFileMessage(file, parentMessage);\n        }}\n        onUserMentioned={(user) => {\n          if (selectedUser?.userId === user?.userId) {\n            setSelectedUser(null);\n            setMentionNickname('');\n          }\n        }}\n        onMentionStringChange={(mentionText) => {\n          setMentionNickname(mentionText);\n        }}\n        onMentionedUserIdsUpdated={(userIds) => {\n          setMentionedUserIds(userIds);\n        }}\n        onKeyDown={(e) => {\n          if (displaySuggestedMentionList && mentionSuggestedUsers?.length > 0\n            && ((e.key === MessageInputKeys.Enter && ableMention) || e.key === MessageInputKeys.ArrowUp || e.key === MessageInputKeys.ArrowDown)\n          ) {\n            setMessageInputEvent(e);\n            return true;\n          }\n          return false;\n        }}\n      />\n    </div>\n  );\n}\n\nexport default React.forwardRef(ThreadMessageInput);\n"],"names":["ThreadMessageInput","props","ref","className","config","useSendbirdStateContext","stringSet","useLocalization","isMentionEnabled","isOnline","userMention","_a","useThreadContext","currentChannel","parentMessage","sendMessage","sendFileMessage","isMuted","isChannelFrozen","allThreadMessages","messageInputRef","useRef","disabled","myRole","Role","OPERATOR","_b","useState","mentionNickname","setMentionNickname","_c","mentionedUsers","setMentionedUsers","_d","mentionedUserIds","setMentionedUserIds","_e","selectedUser","setSelectedUser","_f","mentionSuggestedUsers","setMentionSuggestedUsers","_g","ableMention","setAbleMention","_h","messageInputEvent","setMessageInputEvent","displaySuggestedMentionList","length","useEffect","maxMentionCount","filter","userId","i","indexOf","splice","React","concat","user","__spreadArray","users","maxSuggestionCount","url","isFrozen","MESSAGE_INPUT__PLACE_HOLDER__DISABLED","myMutedState","MutedState","MUTED","MESSAGE_INPUT__PLACE_HOLDER__MUTED_SHORT","THREAD__INPUT__REPLY_TO_THREAD","THREAD__INPUT__REPLY_IN_THREAD","startTyping","message","mentionTemplate","quoteMessage","endTyping","file","mentionText","userIds","e","key","MessageInputKeys","Enter","ArrowUp","ArrowDown","forwardRef"],"mappings":"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"}