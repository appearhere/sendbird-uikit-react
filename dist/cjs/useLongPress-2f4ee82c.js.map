{"version":3,"file":"useLongPress-2f4ee82c.js","sources":["../../src/hooks/useLongPress.tsx"],"sourcesContent":["// thanks to: https://stackoverflow.com/questions/48048957/react-long-press-event\n/* example:\n  const Component = ({ onClick }) => {\n    const onLongPress = useLongPress({\n      onClick: onClick,\n      onLongPress: () => {\n        alert('longpress');\n      }\n    }, {\n      delay: 500,\n      shouldPreventDefault: true,\n    });\n    return (\n      <button {...onLongPress}>\n        hello\n      </button>\n    )\n  }\n*/\nimport React, {\n  useState,\n  useRef,\n  useCallback,\n} from 'react';\nimport {\n  useMediaQueryContext,\n} from '../lib/MediaQueryContext';\n\nconst DEFAULT_DURATION = 300;\n\nfunction preventDefault(e: Event) {\n  if (!isTouchEvent(e)) {\n    return\n  }\n\n  if (e.touches.length < 2 && e.preventDefault) {\n    e.preventDefault();\n  }\n}\n\nexport function isTouchEvent(e: Event): e is TouchEvent {\n  return e && 'touches' in e;\n}\n\ninterface PressHandlers<T> {\n  onLongPress: (e: React.MouseEvent<T> | React.TouchEvent<T>) => void;\n  onClick?: (e: React.MouseEvent<T> | React.TouchEvent<T>) => void;\n}\n\ninterface Options {\n  delay?: number;\n  shouldPreventDefault?: boolean;\n}\n\ninterface UseLongPressType<T> {\n  onTouchMove: (e: React.TouchEvent<T>) => void;\n  onMouseDown: (e: React.MouseEvent<T>) => void;\n  onTouchStart: (e: React.TouchEvent<T>) => void;\n  onMouseUp: (e: React.MouseEvent<T>) => void;\n  onMouseLeave: (e: React.MouseEvent<T>) => void;\n  onTouchEnd: (e: React.TouchEvent<T>) => void;\n}\n\nexport default function useLongPress<T> ({\n  onLongPress,\n  onClick,\n}: PressHandlers<T>, {\n  delay = DEFAULT_DURATION,\n  shouldPreventDefault = true,\n}: Options = {}): UseLongPressType<T> {\n  const { isMobile } = useMediaQueryContext();\n  const [longPressTriggered, setLongPressTriggered] = useState(false);\n  const [dragTriggered, setDragTriggered] = useState(false);\n  // https://www.typescriptlang.org/docs/handbook/utility-types.html#returntypetype\n  const timeout = useRef<ReturnType<typeof setTimeout>>();\n  const target = useRef<EventTarget>();\n\n  const start = useCallback((e: React.MouseEvent<T> | React.TouchEvent<T>) => {\n    e.persist();\n    const clonedEvent = {\n      ...e,\n    };\n    setDragTriggered(false);\n    if (shouldPreventDefault && e.target) {\n      e.target.addEventListener(\n        'touchend',\n        preventDefault, {\n          passive: false,\n        },\n      );\n      target.current = e.target;\n    }\n\n    timeout.current = setTimeout(() => {\n      onLongPress(clonedEvent);\n      setLongPressTriggered(true);\n    }, delay);\n  }, [onLongPress, delay, shouldPreventDefault, isMobile]);\n\n  const clear = useCallback((\n    e: React.MouseEvent<T> | React.TouchEvent<T>,\n    shouldTriggerClick = true,\n    onDrag = false,\n  ) => {\n    if (onDrag) {\n      setDragTriggered(true);\n    } else {\n      setDragTriggered(false);\n    }\n    if (timeout?.current) {\n      clearTimeout(timeout.current);\n    }\n    if (shouldTriggerClick && !longPressTriggered && !dragTriggered) {\n      onClick?.(e);\n    }\n    setLongPressTriggered(false);\n    if (shouldPreventDefault && target.current) {\n      target.current.removeEventListener('touchend', preventDefault);\n    }\n  },[shouldPreventDefault, onClick, longPressTriggered, dragTriggered]);\n\n  return {\n    onMouseDown: (e: React.MouseEvent<T>) => start(e),\n    onMouseUp: (e: React.MouseEvent<T>) => clear(e),\n    onMouseLeave: (e: React.MouseEvent<T>) => clear(e, false),\n    onTouchStart: (e: React.TouchEvent<T>) => start(e),\n    // setDragTriggered as true on touchmove, so that next onTouchEnd is ignored\n    // if we dont do it, onClick?.(e) will be triggred, see inside clear()\n    onTouchMove: (e: React.TouchEvent<T>) => clear(e, false, true),\n    onTouchEnd: (e: React.TouchEvent<T>) => clear(e),\n  };\n}\n"],"names":["DEFAULT_DURATION","preventDefault","e","isTouchEvent","touches","length","useLongPress","_a","_b","onLongPress","onClick","_c","_d","delay","_e","shouldPreventDefault","isMobile","useMediaQueryContext","_f","useState","longPressTriggered","setLongPressTriggered","_g","dragTriggered","setDragTriggered","timeout","useRef","target","start","useCallback","persist","clonedEvent","__assign","addEventListener","passive","current","setTimeout","clear","shouldTriggerClick","onDrag","clearTimeout","removeEventListener","onMouseDown","onMouseUp","onMouseLeave","onTouchStart","onTouchMove","onTouchEnd"],"mappings":"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"}