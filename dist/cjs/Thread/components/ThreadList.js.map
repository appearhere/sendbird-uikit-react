{"version":3,"file":"ThreadList.js","sources":["../../../../src/smart-components/Thread/components/ThreadList/index.tsx"],"sourcesContent":["import React, { RefObject, useMemo } from 'react';\nimport { BaseMessage, FileMessage, UserMessage } from '@sendbird/chat/message';\n\nimport './index.scss';\nimport ThreadListItem from './ThreadListItem';\nimport { useThreadContext } from '../../context/ThreadProvider';\nimport { compareMessagesForGrouping } from '../../context/utils';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport { isSameDay } from 'date-fns';\n\nexport interface ThreadListProps {\n  className?: string;\n  allThreadMessages: Array<UserMessage | FileMessage | BaseMessage>;\n  renderMessage?: (props: {\n    message: UserMessage | FileMessage,\n    chainTop: boolean,\n    chainBottom: boolean,\n    hasSeparator: boolean,\n  }) => React.ReactElement;\n  renderCustomSeparator?: (props: { message: UserMessage | FileMessage }) => React.ReactElement;\n  scrollRef?: RefObject<HTMLDivElement>;\n  scrollBottom?: number;\n}\n\nexport default function ThreadList({\n  className,\n  allThreadMessages,\n  renderMessage,\n  renderCustomSeparator,\n  scrollRef,\n  scrollBottom,\n}: ThreadListProps): React.ReactElement {\n  const { config } = useSendbirdStateContext();\n  const { replyType } = config;\n  const {\n    currentChannel,\n  } = useThreadContext();\n\n  const MemorizedMessage = useMemo(() => ({\n    message,\n    chainTop,\n    chainBottom,\n    hasSeparator,\n  }) => {\n\n    if (typeof renderMessage === 'function') {\n      return renderMessage({\n        message: message as UserMessage | FileMessage,\n        chainTop,\n        chainBottom,\n        hasSeparator,\n      });\n    }\n    return null;\n  }, [renderMessage]);\n\n  return (\n    <div className={`sendbird-thread-list ${className}`}>\n      {allThreadMessages.map((message, idx) => {\n        const prevMessage = allThreadMessages[idx - 1];\n        const nextMessage = allThreadMessages[idx + 1];\n        const [chainTop, chainBottom] = true// isMessageGroupingEnabled\n          ? compareMessagesForGrouping(\n            prevMessage as UserMessage | FileMessage,\n            message as UserMessage | FileMessage,\n            nextMessage as UserMessage | FileMessage,\n            currentChannel,\n            replyType,\n          )\n          : [false, false];\n        const hasSeparator = !(prevMessage?.createdAt > 0 && (\n          isSameDay(message?.createdAt, prevMessage?.createdAt)\n        ));\n\n        const handleScroll = () => {\n          const current = scrollRef?.current;\n          if (current) {\n            const bottom = current.scrollHeight - current.scrollTop - current.offsetHeight;\n            if (scrollBottom < bottom) {\n              current.scrollTop += bottom - scrollBottom;\n            }\n          }\n        };\n\n        return MemorizedMessage({\n          message,\n          chainTop,\n          chainBottom,\n          hasSeparator,\n        }) || (\n            <ThreadListItem\n              message={message as UserMessage | FileMessage}\n              chainTop={chainTop}\n              chainBottom={chainBottom}\n              hasSeparator={hasSeparator}\n              renderCustomSeparator={renderCustomSeparator}\n              handleScroll={handleScroll}\n            />\n          );\n      })}\n    </div>\n  );\n}\n"],"names":["ThreadList","_a","className","allThreadMessages","renderMessage","renderCustomSeparator","scrollRef","scrollBottom","config","useSendbirdStateContext","replyType","currentChannel","useThreadContext","MemorizedMessage","useMemo","message","chainTop","chainBottom","hasSeparator","React","concat","map","idx","prevMessage","nextMessage","compareMessagesForGrouping","createdAt","isSameDay","handleScroll","current","bottom","scrollHeight","scrollTop","offsetHeight","ThreadListItem"],"mappings":"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"}