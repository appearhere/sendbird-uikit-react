{"version":3,"file":"InviteUsers.js","sources":["../../../../src/smart-components/CreateChannel/components/InviteUsers/utils.ts","../../../../src/smart-components/CreateChannel/components/InviteUsers/index.tsx"],"sourcesContent":["import type { ApplicationUserListQuery } from \"@sendbird/chat\";\nimport type { GroupChannelCreateParams, SendbirdGroupChat } from \"@sendbird/chat/groupChannel\";\nimport { CHANNEL_TYPE } from \"../../types\";\n\nexport const filterUser = (idsToFilter: string[]) => (currentId: string): boolean => idsToFilter?.includes(currentId);\n\nexport const setChannelType = (\n  params: GroupChannelCreateParams,\n  type: CHANNEL_TYPE,\n): GroupChannelCreateParams => {\n  if (type === 'broadcast') {\n    // eslint-disable-next-line no-param-reassign\n    params.isBroadcast = true;\n  }\n  if (type === 'supergroup') {\n    // eslint-disable-next-line no-param-reassign\n    params.isSuper = true;\n  }\n  return params;\n};\n\ntype CreateDefaultUserListQueryType = {\n  sdk: SendbirdGroupChat;\n  userFilledApplicationUserListQuery?: ApplicationUserListQuery;\n}\n\nexport const createDefaultUserListQuery = (\n  { sdk, userFilledApplicationUserListQuery }: CreateDefaultUserListQueryType\n): ApplicationUserListQuery => {\n  if (sdk?.createApplicationUserListQuery) {\n    const params = sdk?.createApplicationUserListQuery();\n    if (userFilledApplicationUserListQuery) {\n      Object.keys(userFilledApplicationUserListQuery).forEach((key) => {\n        params[key] = userFilledApplicationUserListQuery[key];\n      });\n    }\n    return params;\n  }\n};\n","import React, { useState, useEffect, useContext } from 'react';\nimport type { ApplicationUserListQuery } from '@sendbird/chat';\n\nimport './invite-users.scss';\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { useCreateChannelContext } from '../../context/CreateChannelProvider';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport type { GroupChannelCreateParams, SendbirdGroupChat } from '@sendbird/chat/groupChannel';\n\nimport Modal from '../../../../ui/Modal';\nimport Label, {\n  LabelColors,\n  LabelTypography,\n} from '../../../../ui/Label';\nimport { ButtonTypes } from '../../../../ui/Button';\nimport UserListItem from '../../../../ui/UserListItem';\nimport { UserListQuery } from '../../context/CreateChannelProvider';\n\nimport {\n  filterUser,\n  setChannelType,\n  createDefaultUserListQuery,\n} from './utils';\n\nexport interface InviteUsersProps {\n  onCancel?: () => void;\n  userListQuery?(): UserListQuery;\n}\n\nconst appHeight = () => {\n  try {\n    const doc = document.documentElement;\n    doc.style.setProperty('--sendbird-vh', (window.innerHeight*.01) + 'px');\n  } catch {}\n}\n\nconst InviteUsers: React.FC<InviteUsersProps> = ({\n  onCancel,\n  userListQuery,\n}: InviteUsersProps) => {\n  const {\n    onBeforeCreateChannel,\n    onCreateChannel,\n    overrideInviteUser,\n    createChannel,\n    type,\n  } = useCreateChannelContext();\n\n  const globalStore = useSendbirdStateContext();\n  const userId = globalStore?.config?.userId;\n  const sdk = globalStore?.stores?.sdkStore?.sdk as SendbirdGroupChat;\n  const idsToFilter = [userId];\n  const [users, setUsers] = useState([]);\n  const [selectedUsers, setSelectedUsers] = useState({});\n  const { stringSet } = useContext(LocalizationContext);\n  const [usersDataSource, setUsersDataSource] = useState<ApplicationUserListQuery | UserListQuery>(null);\n  const selectedCount = Object.keys(selectedUsers).length;\n  const titleText = stringSet.MODAL__CREATE_CHANNEL__TITLE;\n  const submitText = stringSet.BUTTON__CREATE;\n\n  const userQueryCreator = userListQuery ? userListQuery() : createDefaultUserListQuery({ sdk });\n\n  useEffect(() => {\n    const applicationUserListQuery = userQueryCreator;\n    setUsersDataSource(applicationUserListQuery);\n    // @ts-ignore\n    if (!applicationUserListQuery?.isLoading) {\n      applicationUserListQuery.next().then((users_) => {\n        setUsers(users_);\n      });\n    }\n  }, []);\n\n  // https://stackoverflow.com/a/70302463\n  // https://css-tricks.com/the-trick-to-viewport-units-on-mobile/#css-custom-properties-the-trick-to-correct-sizing\n  // to fix navbar break in mobile\n  useEffect(() => {\n    appHeight();\n    window.addEventListener('resize', appHeight);\n    return () => {\n      window.removeEventListener('resize', appHeight);\n    }\n  }, []);\n\n  return (\n    <Modal\n      isFullScreenOnMobile\n      titleText={titleText}\n      submitText={submitText}\n      type={ButtonTypes.PRIMARY}\n      disabled={Object.keys(selectedUsers).length === 0}\n      onCancel={onCancel}\n      onSubmit={() => {\n        const selectedUserList = Object.keys(selectedUsers);\n        if (typeof overrideInviteUser === 'function') {\n          overrideInviteUser({\n            users: selectedUserList,\n            onClose: onCancel,\n            channelType: type,\n          });\n          return;\n        }\n        if (selectedUserList.length > 0) {\n          if (onBeforeCreateChannel) {\n            const params = onBeforeCreateChannel(selectedUserList);\n            setChannelType(params, type);\n            createChannel(params).then((channel) => {\n              onCreateChannel(channel);\n            });\n          } else {\n            const params: GroupChannelCreateParams = {};\n            params.invitedUserIds = selectedUserList;\n            params.isDistinct = false;\n            if (userId) {\n              params.operatorUserIds = [userId];\n            }\n            setChannelType(params, type);\n            // do not have custom params\n            createChannel(params).then((channel) => {\n              onCreateChannel(channel);\n            });\n          }\n          onCancel();\n        }\n      }}\n    >\n      <div>\n        <Label\n          color={(selectedCount > 0) ? LabelColors.PRIMARY : LabelColors.ONBACKGROUND_3}\n          type={LabelTypography.CAPTION_1}\n        >\n          {`${selectedCount} ${stringSet.MODAL__INVITE_MEMBER__SELECTED}`}\n        </Label>\n        <div\n          className=\"sendbird-create-channel--scroll\"\n          onScroll={(e) => {\n            const eventTarget = e.target as HTMLDivElement;\n            const { hasNext } = usersDataSource;\n            const fetchMore = (\n              eventTarget.clientHeight + eventTarget.scrollTop === eventTarget.scrollHeight\n            );\n\n            if (hasNext && fetchMore) {\n              usersDataSource.next().then((usersBatch) => {\n                setUsers([\n                  ...users,\n                  ...usersBatch,\n                ]);\n              });\n            }\n          }}\n        >\n          {\n            users.map((user) => (!filterUser(idsToFilter)(user.userId)) && (\n              <UserListItem\n                key={user.userId}\n                user={user}\n                checkBox\n                checked={selectedUsers[user.userId]}\n                onChange={\n                  (event) => {\n                    const modifiedSelectedUsers = {\n                      ...selectedUsers,\n                      [event.target.id]: event.target.checked,\n                    };\n                    if (!event.target.checked) {\n                      delete modifiedSelectedUsers[event.target.id];\n                    }\n                    setSelectedUsers(modifiedSelectedUsers);\n                  }\n                }\n              />\n            ))\n          }\n        </div>\n      </div>\n    </Modal>\n  );\n};\n\nexport default InviteUsers;\n"],"names":["filterUser","idsToFilter","currentId","includes","setChannelType","params","type","isBroadcast","isSuper","createDefaultUserListQuery","_a","sdk","userFilledApplicationUserListQuery","createApplicationUserListQuery","params_1","Object","keys","forEach","key","appHeight","doc","document","documentElement","style","setProperty","window","innerHeight","InviteUsers","onCancel","userListQuery","_e","useCreateChannelContext","onBeforeCreateChannel","onCreateChannel","overrideInviteUser","createChannel","globalStore","useSendbirdStateContext","userId","_b","config","_d","_c","stores","sdkStore","_f","useState","users","setUsers","_g","selectedUsers","setSelectedUsers","stringSet","useContext","LocalizationContext","_h","usersDataSource","setUsersDataSource","selectedCount","length","titleText","MODAL__CREATE_CHANNEL__TITLE","submitText","BUTTON__CREATE","userQueryCreator","useEffect","applicationUserListQuery","isLoading","next","then","users_","addEventListener","removeEventListener","React","Modal","ButtonTypes","PRIMARY","selectedUserList","onClose","channelType","channel","invitedUserIds","isDistinct","operatorUserIds","Label","LabelColors","ONBACKGROUND_3","LabelTypography","CAPTION_1","concat","MODAL__INVITE_MEMBER__SELECTED","e","eventTarget","target","hasNext","fetchMore","clientHeight","scrollTop","scrollHeight","usersBatch","__spreadArray","map","user","UserListItem","event","modifiedSelectedUsers","__assign","id","checked"],"mappings":"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"}