{"version":3,"file":"SuggestedMentionList.js","sources":["../../../../src/smart-components/Channel/components/SuggestedMentionList/SuggestedUserMentionItem.tsx","../../../../src/smart-components/Channel/components/SuggestedMentionList/index.tsx"],"sourcesContent":["import React, { useContext, useEffect, useMemo, useRef } from 'react';\nimport type { Member } from '@sendbird/chat/groupChannel';\nimport type { User } from '@sendbird/chat';\n\nimport Avatar from '../../../../ui/Avatar';\nimport Label, { LabelTypography, LabelColors } from '../../../../ui/Label';\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { MentionItemUIEvent } from '../../../..';\nimport uuidv4 from '../../../../utils/uuid';\n\ninterface SuggestedUserMentionItemProps {\n  member: User | Member;\n  isFocused?: boolean;\n  parentScrollRef?: React.RefObject<HTMLDivElement>;\n  onClick?: (props: MentionItemUIEvent) => void;\n  onMouseOver?: (props: MentionItemUIEvent) => void;\n  onMouseMove?: (props: MentionItemUIEvent) => void;\n  renderUserMentionItem?: (props: { user: User | Member }) => JSX.Element;\n}\n\nfunction SuggestedUserMentionItem(props: SuggestedUserMentionItemProps): JSX.Element {\n  const {\n    member,\n    isFocused = false,\n    parentScrollRef,\n    onClick,\n    onMouseOver,\n    onMouseMove,\n    renderUserMentionItem,\n  } = props;\n  const scrollRef = useRef(null);\n  const { stringSet = {} } = useContext(LocalizationContext);\n  useEffect(() => {\n    if (isFocused) {\n      if (parentScrollRef?.current?.scrollTop >= scrollRef?.current?.offsetTop) {\n        scrollRef?.current?.scrollIntoView({ block: \"nearest\", inline: \"nearest\" });\n      } else if (parentScrollRef?.current?.scrollTop + parentScrollRef?.current?.clientHeight <= scrollRef?.current?.offsetTop) {\n        scrollRef?.current?.scrollIntoView({ block: \"nearest\", inline: \"nearest\" });\n      }\n    }\n  }, [isFocused]);\n  const customMentionItem = useMemo(() => {\n    if (renderUserMentionItem) {\n      return (\n        <div\n          className=\"sendbird-mention-suggest-list__user-item\"\n          onClick={(event) => onClick?.({ event, member: (member as Member), itemRef: scrollRef })}\n          onMouseOver={(event) => onMouseOver?.({ event, member: (member as Member), itemRef: scrollRef })}\n          onMouseMove={(event) => onMouseMove?.({ event, member: (member as Member), itemRef: scrollRef })}\n          key={member?.userId || uuidv4()}\n          ref={scrollRef}\n        >\n          {renderUserMentionItem({ user: member })}\n        </div>\n      );\n    }\n  }, [renderUserMentionItem]);\n  if (customMentionItem) {\n    return customMentionItem;\n  }\n  return (\n    <div\n      className={`sendbird-mention-suggest-list__user-item ${isFocused ? 'focused' : ''}`}\n      onClick={(event) => onClick?.({ event, member: (member as Member), itemRef: scrollRef })}\n      onMouseOver={(event) => onMouseOver?.({ event, member: (member as Member), itemRef: scrollRef })}\n      onMouseMove={(event) => onMouseMove?.({ event, member: (member as Member), itemRef: scrollRef })}\n      key={member?.userId || uuidv4()}\n      ref={scrollRef}\n    >\n      <Avatar\n        className=\"sendbird-mention-suggest-list__user-item__avatar\"\n        src={member?.profileUrl}\n        alt=\"user-profile\"\n        width=\"24px\"\n        height=\"24px\"\n      />\n      <Label\n        className=\"sendbird-mention-suggest-list__user-item__nickname\"\n        type={LabelTypography.SUBTITLE_2}\n        color={member?.nickname ? LabelColors.ONBACKGROUND_1 : LabelColors.ONBACKGROUND_3}\n      >\n        {member?.nickname || stringSet?.MENTION_NAME__NO_NAME}\n      </Label>\n      <Label\n        className=\"sendbird-mention-suggest-list__user-item__user-id\"\n        type={LabelTypography.SUBTITLE_2}\n        color={LabelColors.ONBACKGROUND_2}\n      >\n        {member?.userId}\n      </Label>\n    </div>\n  );\n}\n\nexport default SuggestedUserMentionItem;\n","import './index.scss';\nimport React, { useState, useEffect, useContext, useRef } from 'react';\nimport type { User } from '@sendbird/chat';\nimport type { Member } from '@sendbird/chat/groupChannel';\n\nimport Label, { LabelTypography, LabelColors } from '../../../../ui/Label';\nimport Icon, { IconTypes, IconColors } from '../../../../ui/Icon';\nimport SuggestedUserMentionItem from './SuggestedUserMentionItem';\nimport { useChannelContext } from '../../context/ChannelProvider';\nimport useSendbirdStateContext from '../../../../hooks/useSendbirdStateContext';\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { MAX_USER_MENTION_COUNT, MAX_USER_SUGGESTION_COUNT, USER_MENTION_TEMP_CHAR } from '../../context/const';\nimport { MessageInputKeys } from '../../../../ui/MessageInput/const';\nimport uuidv4 from '../../../../utils/uuid';\nimport { useThreadContext } from '../../../Thread/context/ThreadProvider';\n\nexport interface SuggestedMentionListProps {\n  className?: string;\n  targetNickname: string;\n  memberListQuery?: Record<string, string>;\n  onUserItemClick?: (member: User) => void;\n  onFocusItemChange?: (member: User) => void;\n  onFetchUsers?: (users: Array<User>) => void;\n  renderUserMentionItem?: (props: { user: User }) => JSX.Element;\n  ableAddMention: boolean;\n  maxMentionCount?: number;\n  maxSuggestionCount?: number;\n  inputEvent?: React.KeyboardEvent<HTMLDivElement>;\n}\n\nconst DEBOUNCING_TIME = 300;\n\nfunction SuggestedMentionList(props: SuggestedMentionListProps): JSX.Element {\n  const {\n    className,\n    targetNickname = '',\n    // memberListQuery,\n    onUserItemClick,\n    onFocusItemChange,\n    onFetchUsers,\n    renderUserMentionItem,\n    inputEvent,\n    ableAddMention = true,\n    maxMentionCount = MAX_USER_MENTION_COUNT,\n    maxSuggestionCount = MAX_USER_SUGGESTION_COUNT,\n  } = props;\n  const currentGroupChannel = useChannelContext?.()?.currentGroupChannel;\n  const currentChannel = useThreadContext?.()?.currentChannel;\n  const channelInstance = currentGroupChannel || currentChannel;\n  const { config, stores } = useSendbirdStateContext();\n  const { logger } = config;\n  const currentUserId = stores?.sdkStore?.sdk?.currentUser?.userId || '';\n  const scrollRef = useRef(null);\n  const { stringSet } = useContext(LocalizationContext);\n  const [timer, setTimer] = useState(null);\n  const [searchString, setSearchString] = useState('');\n  const [lastSearchString, setLastSearchString] = useState('');\n  const [currentUser, setCurrentUser] = useState<User>(null);\n  const [currentMemberList, setCurrentMemberList] = useState<Array<Member>>([]);\n\n  useEffect(() => {\n    clearTimeout(timer);\n    setTimer(\n      setTimeout(() => {\n        setSearchString(targetNickname);\n      }, DEBOUNCING_TIME)\n    );\n  }, [targetNickname]);\n\n  useEffect(() => {\n    if (inputEvent?.key === MessageInputKeys.Enter) {\n      if (currentMemberList.length > 0) {\n        onUserItemClick(currentUser);\n      }\n    }\n    if (inputEvent?.key === MessageInputKeys.ArrowUp) {\n      const currentUserIndex = currentMemberList.findIndex((member) => (\n        member?.userId === currentUser?.userId\n      ));\n      if (0 < currentUserIndex) {\n        setCurrentUser(currentMemberList[currentUserIndex - 1]);\n        onFocusItemChange(currentMemberList[currentUserIndex - 1]);\n      }\n    }\n    if (inputEvent?.key === MessageInputKeys.ArrowDown) {\n      const currentUserIndex = currentMemberList.findIndex((member) => (\n        member?.userId === currentUser?.userId\n      ));\n      if (currentUserIndex < currentMemberList.length - 1) {\n        setCurrentUser(currentMemberList[currentUserIndex + 1]);\n        onFocusItemChange(currentMemberList[currentUserIndex + 1]);\n      }\n    }\n  }, [inputEvent]);\n\n  /* Fetch member list */\n  useEffect(() => {\n    if (!channelInstance?.createMemberListQuery) {\n      logger.warning('SuggestedMentionList: Creating member list query failed');\n      return;\n    }\n    if (lastSearchString && searchString.indexOf(lastSearchString) === 0 && currentMemberList.length === 0) {\n      // Don't need to request query again\n      return;\n    }\n\n    const query = channelInstance?.createMemberListQuery({\n      limit: maxSuggestionCount + 1,  // because current user could be included\n      nicknameStartsWithFilter: searchString.slice(USER_MENTION_TEMP_CHAR.length),\n    });\n    // Add member list query for customization\n    query.next()\n      .then((memberList) => {\n        const suggestingMembers = memberList\n          .filter((member) => currentUserId !== member?.userId)\n          .slice(0, maxSuggestionCount);\n        if (suggestingMembers.length < 1) {\n          logger.info('SuggestedMentionList: Fetched member list is empty');\n        } else {\n          logger.info('SuggestedMentionList: Fetching member list succeeded', { memberListQuery: query, memberList: suggestingMembers });\n          setCurrentUser(suggestingMembers[0]);\n        }\n        setLastSearchString(searchString);\n        onFetchUsers(suggestingMembers);\n        setCurrentMemberList(suggestingMembers);\n      })\n      .catch((error) => {\n        if (error) {\n          logger.error('SuggestedMentionList: Fetching member list failed', error);\n        }\n      });\n  }, [channelInstance?.url, searchString]);\n\n  if (!ableAddMention && currentMemberList.length === 0) {\n    return null;\n  }\n\n  return (\n    <div\n      className={`sendbird-mention-suggest-list ${className}`}\n      key=\"sendbird-mention-suggest-list\"\n      ref={scrollRef}\n    >\n      {\n        ableAddMention && currentMemberList?.map((member) => (\n          <SuggestedUserMentionItem\n            key={member?.userId || uuidv4()}\n            member={member}\n            isFocused={member?.userId === currentUser?.userId}\n            parentScrollRef={scrollRef}\n            onClick={({ member }) => {\n              onUserItemClick(member);\n            }}\n            onMouseOver={({ member }) => {\n              setCurrentUser(member);\n            }}\n            renderUserMentionItem={renderUserMentionItem}\n          />\n        ))\n      }\n      {\n        !ableAddMention && (\n          <div className=\"sendbird-mention-suggest-list__notice-item\">\n            <Icon\n              className=\"sendbird-mention-suggest-list__notice-item__icon\"\n              type={IconTypes.INFO}\n              fillColor={IconColors.ON_BACKGROUND_2}\n              width=\"20px\"\n              height=\"20px\"\n            />\n            <Label\n              className=\"sendbird-mention-suggest-list__notice-item__text\"\n              type={LabelTypography.SUBTITLE_2}\n              color={LabelColors.ONBACKGROUND_2}\n            >\n              {stringSet.MENTION_COUNT__OVER_LIMIT.replace('%d', maxMentionCount)}\n            </Label>\n          </div>\n        )\n      }\n    </div>\n  );\n}\n\nexport default SuggestedMentionList;\n"],"names":["SuggestedUserMentionItem","props","member","_a","isFocused","parentScrollRef","onClick","onMouseOver","onMouseMove","renderUserMentionItem","scrollRef","useRef","_b","useContext","LocalizationContext","stringSet","useEffect","current","scrollTop","offsetTop","_c","scrollIntoView","block","inline","_d","_e","clientHeight","_f","_g","customMentionItem","useMemo","React","event","itemRef","userId","uuidv4","user","concat","Avatar","profileUrl","Label","LabelTypography","SUBTITLE_2","nickname","LabelColors","ONBACKGROUND_1","ONBACKGROUND_3","MENTION_NAME__NO_NAME","ONBACKGROUND_2","DEBOUNCING_TIME","SuggestedMentionList","className","targetNickname","onUserItemClick","onFocusItemChange","onFetchUsers","inputEvent","ableAddMention","_h","maxMentionCount","MAX_USER_MENTION_COUNT","_j","maxSuggestionCount","MAX_USER_SUGGESTION_COUNT","currentGroupChannel","useChannelContext","currentChannel","useThreadContext","channelInstance","_k","useSendbirdStateContext","config","stores","logger","currentUserId","sdkStore","sdk","currentUser","_l","useState","timer","setTimer","_m","searchString","setSearchString","_o","lastSearchString","setLastSearchString","_p","setCurrentUser","_q","currentMemberList","setCurrentMemberList","clearTimeout","setTimeout","key","MessageInputKeys","Enter","length","ArrowUp","currentUserIndex","findIndex","ArrowDown","createMemberListQuery","warning","indexOf","query","limit","nicknameStartsWithFilter","slice","USER_MENTION_TEMP_CHAR","next","then","memberList","suggestingMembers","filter","info","memberListQuery","catch","error","url","map","Icon","IconTypes","INFO","IconColors","ON_BACKGROUND_2","MENTION_COUNT__OVER_LIMIT","replace"],"mappings":"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"}