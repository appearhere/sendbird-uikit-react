{"version":3,"file":"OpenChannelMessageList.js","sources":["../../../../src/smart-components/OpenChannel/components/OpenChannelMessageList/index.tsx"],"sourcesContent":["import './openchannel-message-list.scss';\n\nimport React, { ReactElement, useRef, useState, useMemo } from 'react';\nimport isSameDay from 'date-fns/isSameDay';\n\nimport Icon, { IconTypes, IconColors } from '../../../../ui/Icon';\n\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport { compareMessagesForGrouping } from '../../context/utils';\nimport { useOpenChannelContext } from '../../context/OpenChannelProvider';\nimport OpenChannelMessage from '../OpenChannelMessage';\nimport { RenderMessageProps } from '../../../../types';\nimport { FileMessage, UserMessage } from '@sendbird/chat/message';\n\nexport type OpenchannelMessageListProps = {\n  renderMessage?: (props: RenderMessageProps) => React.ElementType<RenderMessageProps>;\n  renderPlaceHolderEmptyList?: () => React.ReactElement;\n}\n\nfunction OpenchannelMessageList(\n  props: OpenchannelMessageListProps,\n  ref: React.RefObject<HTMLDivElement>,\n): ReactElement {\n  const {\n    isMessageGroupingEnabled = true,\n    allMessages,\n    hasMore,\n    onScroll,\n  } = useOpenChannelContext();\n  const scrollRef = ref || useRef(null);\n  const [showScrollDownButton, setShowScrollDownButton] = useState(false);\n\n  const handleOnScroll = (e) => {\n    const element = e.target;\n    const {\n      scrollTop,\n      scrollHeight,\n      clientHeight,\n    } = element;\n    if (scrollHeight > scrollTop + clientHeight + 1) {\n      setShowScrollDownButton(true);\n    } else {\n      setShowScrollDownButton(false);\n    }\n\n    if (!hasMore) {\n      return;\n    }\n    if (scrollTop === 0) {\n      const nodes = scrollRef.current.querySelectorAll('.sendbird-msg--scroll-ref');\n      const first = nodes && nodes[0];\n      onScroll(() => {\n        try {\n          first.scrollIntoView();\n        } catch (error) { }\n      });\n    }\n  };\n\n  const scrollToBottom = () => {\n    if (scrollRef && scrollRef.current) {\n      scrollRef.current.scrollTo(0, scrollRef.current.scrollHeight);\n      setShowScrollDownButton(false);\n    }\n  };\n\n  const memoizedMessageList = useMemo(() => {\n    if (allMessages.length > 0) {\n      return (\n        allMessages.map((message, index) => {\n          const previousMessage = allMessages[index - 1];\n          const nextMessage = allMessages[index - 1];\n\n          const previousMessageCreatedAt = previousMessage && previousMessage.createdAt;\n          const currentCreatedAt = message?.createdAt;\n          // https://stackoverflow.com/a/41855608\n          const hasSeparator = !(previousMessageCreatedAt && (\n            isSameDay(currentCreatedAt, previousMessageCreatedAt)\n          ));\n\n          const [chainTop, chainBottom] = isMessageGroupingEnabled\n            ? compareMessagesForGrouping(previousMessage, message, nextMessage)\n            : [false, false];\n          return (\n            <OpenChannelMessage\n              key={message?.messageId || (message as UserMessage | FileMessage)?.reqId}\n              message={message}\n              chainTop={chainTop}\n              chainBottom={chainBottom}\n              hasSeparator={hasSeparator}\n              renderMessage={props?.renderMessage}\n            />\n          )\n        })\n      );\n    }\n    return (\n      props?.renderPlaceHolderEmptyList?.() || (\n        <PlaceHolder\n          className=\"sendbird-openchannel-conversation-scroll__container__place-holder\"\n          type={PlaceHolderTypes.NO_MESSAGES}\n        />\n      )\n    );\n  }, [allMessages]);\n\n  return (\n    <div className=\"sendbird-openchannel-conversation-scroll\">\n      <div className=\"sendbird-openchannel-conversation-scroll__container\">\n        <div className=\"sendbird-openchannel-conversation-scroll__container__padding\" />\n        <div\n          className={[\n            'sendbird-openchannel-conversation-scroll__container__item-container',\n            (allMessages.length > 0) ? '' : 'no-messages',\n          ].join(' ')}\n          onScroll={handleOnScroll}\n          ref={scrollRef}\n        >\n          {memoizedMessageList}\n        </div>\n      </div>\n      {\n        showScrollDownButton && (\n          <div\n            className=\"sendbird-openchannel-conversation-scroll__container__scroll-bottom-button\"\n            onClick={scrollToBottom}\n            onKeyDown={scrollToBottom}\n            tabIndex={0}\n            role=\"button\"\n          >\n            <Icon\n              width=\"24px\"\n              height=\"24px\"\n              type={IconTypes.CHEVRON_DOWN}\n              fillColor={IconColors.CONTENT}\n            />\n          </div>\n        )\n      }\n    </div>\n  );\n}\n\nexport default React.forwardRef(OpenchannelMessageList);\n"],"names":["OpenchannelMessageList","props","ref","_a","useOpenChannelContext","_b","isMessageGroupingEnabled","allMessages","hasMore","onScroll","scrollRef","useRef","_c","useState","showScrollDownButton","setShowScrollDownButton","handleOnScroll","e","element","target","scrollTop","scrollHeight","clientHeight","nodes","current","querySelectorAll","first_1","scrollIntoView","error","scrollToBottom","scrollTo","memoizedMessageList","useMemo","length","map","message","index","previousMessage","nextMessage","previousMessageCreatedAt","createdAt","currentCreatedAt","hasSeparator","isSameDay","compareMessagesForGrouping","chainTop","chainBottom","React","OpenChannelMessage","messageId","reqId","renderMessage","renderPlaceHolderEmptyList","call","PlaceHolder","PlaceHolderTypes","NO_MESSAGES","join","Icon","IconTypes","CHEVRON_DOWN","IconColors","CONTENT","forwardRef"],"mappings":"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"}