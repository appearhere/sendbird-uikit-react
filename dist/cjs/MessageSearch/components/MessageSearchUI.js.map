{"version":3,"file":"MessageSearchUI.js","sources":["../../../../src/smart-components/MessageSearch/components/MessageSearchUI/index.tsx"],"sourcesContent":["import React, { useContext } from 'react';\nimport type { FileMessage, UserMessage } from '@sendbird/chat/message';\nimport './index.scss';\n\nimport { LocalizationContext } from '../../../../lib/LocalizationContext';\nimport { useMessageSearchContext } from '../../context/MessageSearchProvider';\n\nimport MessageSearchItem from '../../../../ui/MessageSearchItem';\nimport PlaceHolder, { PlaceHolderTypes } from '../../../../ui/PlaceHolder';\nimport MessageSearchFileItem from '../../../../ui/MessageSearchFileItem';\nimport { ClientSentMessages } from '../../../../types';\n\n\nconst COMPONENT_CLASS_NAME = 'sendbird-message-search';\n\nexport interface MessageSearchUIProps {\n  renderPlaceHolderError?: (props: void) => React.ReactElement;\n  renderPlaceHolderLoading?: (props: void) => React.ReactElement;\n  renderPlaceHolderNoString?: (props: void) => React.ReactElement;\n  renderPlaceHolderEmptyList?: (props: void) => React.ReactElement;\n  renderSearchItem?(\n    {\n      message,\n      onResultClick,\n    }: {\n      message: ClientSentMessages,\n      onResultClick?: (message: ClientSentMessages) => void,\n    }\n  ): JSX.Element;\n}\n\nexport const MessageSearchUI: React.FC<MessageSearchUIProps> = ({\n  renderPlaceHolderError,\n  renderPlaceHolderLoading,\n  renderPlaceHolderNoString,\n  renderPlaceHolderEmptyList,\n  renderSearchItem,\n}: MessageSearchUIProps) => {\n  const {\n    isInvalid,\n    searchString,\n    requestString,\n    currentChannel,\n    retryCount,\n    setRetryCount,\n    loading,\n    scrollRef,\n    hasMoreResult,\n    onScroll,\n    allMessages,\n    onResultClick,\n    selectedMessageId,\n    setSelectedMessageId,\n  } = useMessageSearchContext();\n\n  const { stringSet } = useContext(LocalizationContext);\n\n  const handleRetryToConnect = () => {\n    setRetryCount(retryCount + 1);\n  };\n\n  const handleOnScroll = (e) => {\n    const scrollElement = e.target;\n    const {\n      scrollTop,\n      scrollHeight,\n      clientHeight,\n    } = scrollElement;\n\n    if (!hasMoreResult) {\n      return;\n    }\n    if (scrollTop + clientHeight >= scrollHeight - 1) {\n      onScroll(() => {\n        // after load more searched messages\n      });\n    }\n  };\n\n  const getChannelName = () => {\n    if (currentChannel && currentChannel?.name && currentChannel?.name !== 'Group Channel') {\n      return currentChannel?.name;\n    }\n    if (currentChannel && (currentChannel?.name === 'Group Channel' || !currentChannel?.name)) {\n      return currentChannel.members.map((member) => member.nickname || stringSet.NO_NAME).join(', ');\n    }\n    return stringSet.NO_TITLE;\n  };\n\n  if (isInvalid && searchString && requestString) {\n    return renderPlaceHolderError?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder\n          type={PlaceHolderTypes.WRONG}\n          retryToConnect={handleRetryToConnect}\n        />\n      </div>\n    );\n  }\n\n  if (loading && searchString && requestString) {\n    return renderPlaceHolderLoading?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder type={PlaceHolderTypes.SEARCHING} />\n      </div>\n    );\n  }\n\n  if (!searchString) {\n    return renderPlaceHolderNoString?.() || (\n      <div className={COMPONENT_CLASS_NAME}>\n        <PlaceHolder\n          type={PlaceHolderTypes.SEARCH_IN}\n          searchInString={getChannelName()}\n        />\n      </div>\n    );\n  }\n\n  return (\n    <div\n      className={COMPONENT_CLASS_NAME}\n      onScroll={handleOnScroll}\n      ref={scrollRef}\n    >\n      {\n        (allMessages.length > 0)\n          ? (\n            allMessages.map((message) => {\n              if (renderSearchItem) {\n                return renderSearchItem({ message, onResultClick });\n              }\n              if (message.messageType === 'file') {\n                return (\n                  <MessageSearchFileItem\n                    className={`${COMPONENT_CLASS_NAME}__message-search-item`}\n                    message={message as FileMessage}\n                    key={message.messageId}\n                    selected={(selectedMessageId === message.messageId)}\n                    onClick={() => {\n                      onResultClick(message);\n                      setSelectedMessageId(message.messageId);\n                    }}\n                  />\n                );\n              }\n              return (\n                <MessageSearchItem\n                  className={`${COMPONENT_CLASS_NAME}__message-search-item`}\n                  message={message as UserMessage}\n                  key={message.messageId}\n                  selected={(selectedMessageId === message.messageId)}\n                  onClick={() => {\n                    onResultClick(message);\n                    setSelectedMessageId(message.messageId);\n                  }}\n                />\n              );\n            })\n          )\n          : renderPlaceHolderEmptyList?.() || (\n            <PlaceHolder type={PlaceHolderTypes.NO_RESULTS} />\n          )\n      }\n    </div>\n  );\n};\n\nexport default MessageSearchUI;\n"],"names":["COMPONENT_CLASS_NAME","MessageSearchUI","_a","renderPlaceHolderError","renderPlaceHolderLoading","renderPlaceHolderNoString","renderPlaceHolderEmptyList","renderSearchItem","_b","useMessageSearchContext","isInvalid","searchString","requestString","currentChannel","retryCount","setRetryCount","loading","scrollRef","hasMoreResult","onScroll","allMessages","onResultClick","selectedMessageId","setSelectedMessageId","stringSet","useContext","LocalizationContext","handleRetryToConnect","handleOnScroll","e","scrollElement","target","scrollTop","scrollHeight","clientHeight","getChannelName","name","members","map","member","nickname","NO_NAME","join","NO_TITLE","React","PlaceHolder","PlaceHolderTypes","WRONG","SEARCHING","SEARCH_IN","length","message","messageType","MessageSearchFileItem","concat","messageId","MessageSearchItem","NO_RESULTS"],"mappings":"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"}